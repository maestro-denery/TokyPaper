From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Denery <dorofeevij@gmail.com>
Date: Thu, 1 Sep 2022 00:39:19 +0300
Subject: [PATCH] Paper-Plugins-toky-additions


diff --git a/src/main/java/io/papermc/paper/plugin/manager/PaperPluginManagerImpl.java b/src/main/java/io/papermc/paper/plugin/manager/PaperPluginManagerImpl.java
index 5ed863fddf9fb1cad1261b1e865dfc2f768970f1..4f572d70ab01291ce50881965ca43e5706ff3a6d 100644
--- a/src/main/java/io/papermc/paper/plugin/manager/PaperPluginManagerImpl.java
+++ b/src/main/java/io/papermc/paper/plugin/manager/PaperPluginManagerImpl.java
@@ -216,6 +216,15 @@ public class PaperPluginManagerImpl implements PluginManager, DependencyContext
     public void overridePermissionManager(@Nullable Plugin plugin, @Nullable PermissionManager permissionManager) {
         this.permissionManager = permissionManager;
     }
+	// TokyPaper start
+	public final List<io.papermc.paper.plugin.bootstrap.PluginBootstrap> bootstrappers = new java.util.ArrayList<>();
+
+	@Override
+	public @NotNull List<io.papermc.paper.plugin.bootstrap.PluginBootstrap> getPluginBootstrappers() {
+		return bootstrappers;
+	}
+
+	// TokyPaper end
 
     // Etc
 
diff --git a/src/main/java/io/papermc/paper/plugin/provider/service/entrypoint/storage/ordered/BootstrapProviderStorage.java b/src/main/java/io/papermc/paper/plugin/provider/service/entrypoint/storage/ordered/BootstrapProviderStorage.java
index 6a30e697c3391b9cef814f33e5eb3f7502727df1..11fbfc31ca8741047d65545df9d0e0625fd52963 100644
--- a/src/main/java/io/papermc/paper/plugin/provider/service/entrypoint/storage/ordered/BootstrapProviderStorage.java
+++ b/src/main/java/io/papermc/paper/plugin/provider/service/entrypoint/storage/ordered/BootstrapProviderStorage.java
@@ -35,6 +35,7 @@ public class BootstrapProviderStorage extends OrderedProviderStorage<PluginBoots
                 try {
                     PluginBootstrapContext context = PluginBootstrapContextImpl.of(provider, Main.pluginDirectory);
                     provided.boostrap(context);
+					io.papermc.paper.plugin.manager.PaperPluginManagerImpl.getInstance().bootstrappers.add(provided); // TokyPaper
                     return true;
                 } catch (Exception e) {
                     provider.getLogger().log(Level.SEVERE, "Failed to run bootstrapper for %s. This plugin will not be loaded.".formatted(provider.getSource()), e);
